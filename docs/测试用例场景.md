# 套利测试用例 #001
## 用户A：正确预测单个市场

### 合约行为序列：

#### 时间T0（初始状态）：
- 用户A USDC余额：1000

#### 时间T0（创建头寸）：
1. **用户A调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [1,0], 1000)`
   - 行为：创建YES头寸
   - 参数：抵押1000 USDC，选择YES
   - Gas消耗：0.25 USDC
   - 结果：获得1000 YES代币

#### 时间T0+600秒（市场决议后赎回）：
2. **用户A调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [1])`
   - 行为：赎回YES头寸
   - Gas消耗：0.15 USDC
   - **市场假设**：市场仅有用户A参与，总抵押池=1000 USDC
   - **结果假设**：YES获胜，赔付权重[1,0]
   - 赎回计算：
     - 每个YES赎回价值 = 1000 USDC × 1 / 1000 = 1 USDC
     - 用户A赎回额 = 1000 × 1 = 1000 USDC

### 资金流核算：
- **总投入USDC**: 1000 USDC
- **赎回获得USDC**: 1000 USDC
- **Gas成本**: 0.25 + 0.15 = 0.40 USDC
- **净损益**: 1000 - 1000 - 0.40 = **-0.40 USDC**

### 结论：
用户A单独操作且预测正确，仅损失Gas费用0.40 USDC，但未实现正向收入。

# 套利测试用例 #002
## 用户A正确预测，用户B错误预测

### 合约行为序列：

#### 时间T0（初始状态）：
- 用户A USDC余额：1000
- 用户B USDC余额：1000
- 总抵押池：0

#### 时间T0（用户A创建YES头寸）：
1. **用户A调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [1,0], 600)`
   - 行为：创建YES头寸
   - Gas消耗：0.23 USDC
   - 结果：获得600 YES代币

#### 时间T0+30秒（用户B创建NO头寸）：
2. **用户B调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [0,1], 400)`
   - 行为：创建NO头寸
   - Gas消耗：0.21 USDC
   - 结果：获得400 NO代币

#### 时间T0+600秒（市场决议，YES获胜）：
3. **用户A调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [1])`
   - 行为：赎回YES头寸
   - Gas消耗：0.15 USDC
   - **总抵押池** = 600 + 400 = 1000 USDC
   - **赔付权重** = [1,0] (YES获胜)
   - 赎回计算：
     - 每个YES赎回价值 = 1000 USDC × 1 / 600 ≈ 1.6667 USDC
     - 用户A赎回额 = 600 × 1.6667 = 1000 USDC

4. **用户B调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [2])`
   - 行为：赎回NO头寸
   - Gas消耗：0.15 USDC
   - 赎回计算：
     - 每个NO赎回价值 = 1000 USDC × 0 / 400 = 0 USDC
     - 用户B赎回额 = 0 USDC

### 资金流核算：
**用户A**：
- 投入：600 USDC
- 赎回：1000 USDC
- Gas成本：0.23 + 0.15 = 0.38 USDC
- 净收入：1000 - 600 - 0.38 = **+399.62 USDC**

**用户B**：
- 投入：400 USDC
- 赎回：0 USDC
- Gas成本：0.21 + 0.15 = 0.36 USDC
- 净损失：0 - 400 - 0.36 = **-400.36 USDC**

### 结论：
用户A获得正向收入399.62 USDC，利润来自用户B的损失。

# 套利测试用例 #003
## 三个用户间的套利

### 合约行为序列：

#### 时间T0（初始状态）：
- 用户A USDC余额：500
- 用户B USDC余额：500
- 用户C USDC余额：500
- 做市商 USDC余额：0

#### 时间T0（做市商创建完整头寸）：
1. **做市商调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [1,1], 1000)`
   - 行为：创建完整头寸
   - Gas消耗：0.30 USDC
   - 结果：获得1000 YES + 1000 NO
   - **注意**：做市商初始USDC为0，此处仅为逻辑演示

#### 时间T0+60秒（用户A购买YES）：
2. **用户A调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [1,0], 200)`
   - 行为：创建YES头寸
   - Gas消耗：0.18 USDC
   - 结果：获得200 YES代币

#### 时间T0+120秒（用户B购买NO）：
3. **用户B调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [0,1], 300)`
   - 行为：创建NO头寸
   - Gas消耗：0.20 USDC
   - 结果：获得300 NO代币

#### 时间T0+180秒（用户C购买YES）：
4. **用户C调用** `ConditionalTokens.splitPosition(USDC, 0x0, conditionId1, [1,0], 250)`
   - 行为：创建YES头寸
   - Gas消耗：0.19 USDC
   - 结果：获得250 YES代币

#### 时间T0+600秒（市场决议，YES获胜）：
5. **用户A调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [1])`
   - 行为：赎回YES头寸
   - Gas消耗：0.12 USDC
   - 总抵押池 = 200 + 300 + 250 = 750 USDC
   - 赎回计算：
     - 总YES代币 = 200 + 250 = 450
     - 每个YES价值 = 750 × 1 / 450 ≈ 1.6667 USDC
     - 用户A赎回额 = 200 × 1.6667 ≈ 333.33 USDC

6. **用户B调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [2])`
   - 行为：赎回NO头寸
   - Gas消耗：0.12 USDC
   - 用户B赎回额 = 0 USDC

7. **用户C调用** `ConditionalTokens.redeemPositions(USDC, 0x0, conditionId1, [1])`
   - 行为：赎回YES头寸
   - Gas消耗：0.12 USDC
   - 用户C赎回额 = 250 × 1.6667 ≈ 416.67 USDC

### 资金流核算：
**用户A**：
- 投入：200 USDC
- 赎回：333.33 USDC
- Gas成本：0.18 + 0.12 = 0.30 USDC
- 净收入：333.33 - 200 - 0.30 = **+133.03 USDC**

**用户B**：
- 投入：300 USDC
- 赎回：0 USDC
- Gas成本：0.20 + 0.12 = 0.32 USDC
- 净损失：0 - 300 - 0.32 = **-300.32 USDC**

**用户C**：
- 投入：250 USDC
- 赎回：416.67 USDC
- Gas成本：0.19 + 0.12 = 0.31 USDC
- 净收入：416.67 - 250 - 0.31 = **+166.36 USDC**

**做市商**：
- 未参与实际交易，仅提供初始头寸逻辑

### 结论：
用户A和用户C获得正向收入，利润来自用户B的损失。用户A收入133.03 USDC，用户C收入166.36 USDC。